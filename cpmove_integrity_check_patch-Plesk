--- main.pl.orig    2014-01-10 09:05:15.000000000 -0500
+++ main.pl 2014-02-03 08:47:26.980286678 -0500
@@ -1576,6 +1576,32 @@
         print "md5sum is: $chunks->[0]->{'md5sum'}\n";
     }
 
+    ### http://features.cpanel.net/responses/verify-cpmove-tarball-integrity
+    print "\n\nVerifying tarball integrity...";
+    my $command = "tar ztf $tarball >/dev/null";
+
+    my $pid = IPC::Open3::open3( my ($writer, $reader, $stderr), $command );
+    waitpid( $pid, 0 );
+
+    my $status = $? >> 8;
+
+    if ($status) {
+        if ( !-e $tarball ) {
+            print "$tarball missing?\n";
+        }
+        else {
+            my $name = $tarball;
+            $name =~ /(.*)\.tar\.gz$/;
+            $name = $1;
+
+            print "may be corrupt. Renaming to ${name}-CORRUPT.tar.gz\n";
+            rename $tarball, "${name}-CORRUPT.tar.gz" or print "rename failed!\n";
+        }
+    }
+    else {
+        print "Done\n";
+    }
+
     unlink $logfile;
 }

